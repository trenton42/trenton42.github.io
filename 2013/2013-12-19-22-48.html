<!DOCTYPE html>
<html>
  <head>
    <title>Attaching StringIO Data to a Mailgun Message - Just a Blahg</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/static/css/bootstrap.min.css?v=072e9" rel="stylesheet">
    <link href="/static/pygments.css?v=f1d2c" rel="stylesheet">
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    
    <link rel="alternate" type="application/rss+xml" href="/feed.xml" title="Just a Blahg" />
    
<link rel="canonical" href="/2013/2013-12-19-22-48.html" />


  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <nav class="navbar" role="navigation">
            <ul class="nav navbar-nav">
              
              <li><a href="/">Home</a></li>
              <li><a href="/archive.html">Blahg</a></li>
              <li><a href="/machine.html">A Machine</a></li>
            </ul>
            <h1 class="navbar-right">Ikso Blahg</h1>
          </nav>
        </div>
      </div>
      <div class="row">
        <div class="col-md-8 col-md-offset-1"><div class="hentry">
    <h1 class="entry-title">Attaching StringIO Data to a Mailgun Message</h1>
    <div class="entry-meta">
        <time class="updated" datetime="2013-12-19T22:53:00+05:00" pubdate>
            <a href="/2013/2013-12-19-22-48.html">2013-12-19</a>
        </time>
        <span class="author vcard">
            by <span class="fn">ikso</span>
        </span>
    </div>
    <div class="entry-content">
        <p>Recently i started using <a href="http://www.mailgun.com" title="Mailgun by Rackspace">Mailgun</a> for our outgoing messages. They have a very nice   <a href="http://documentation.mailgun.com" title="Mailgun API documentation">API</a>, and take a lot of the heavy lifting out of creating multipart messages.</p>
<p>If you are using <a href="http://docs.python-requests.org/en/latest/" title="Python Requests library">requests</a> (or <a href="https://github.com/dreid/treq/" title="Python Twisted Requests">treq</a>) to send the messages through their REST API, however, you may have noticed that you must specify &ldquo;attachment&rdquo; as the key, and an open file handle as the value. This works great if you are sending files from the filesystem, but if you need to send generated or in memory data as a file attachment, it just doesn&#39;t work. Added a <code>name</code> attribute to the StringIO class does the trick:</p>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">NamedStringIO</span><span class="p">(</span><span class="n">StringIO</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">StringIO</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
<p>Now using their <a href="http://documentation.mailgun.com/quickstart.html#sending-messages" title="Mailgun example: sending a message">example</a> will work:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">paste.util</span> <span class="kn">import</span> <span class="n">MultiDict</span>

<span class="n">good</span> <span class="o">=</span> <span class="n">NamedStringIO</span><span class="p">(</span><span class="s">&quot;This is some good data&quot;</span><span class="p">,</span> <span class="s">&quot;good.txt&quot;</span><span class="p">)</span>
<span class="n">more</span> <span class="o">=</span> <span class="n">NamedStringIO</span><span class="p">(</span><span class="s">&quot;This is some more good data&quot;</span><span class="p">,</span> <span class="s">&quot;more.txt&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">send_complex_message</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="s">&quot;https://api.mailgun.net/v2/samples.mailgun.org/messages&quot;</span><span class="p">,</span>
        <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="s">&quot;api&quot;</span><span class="p">,</span> <span class="s">&quot;key-PUT_YER_KEY_HERE&quot;</span><span class="p">),</span>
        <span class="n">files</span><span class="o">=</span><span class="n">MultiDict</span><span class="p">([(</span><span class="s">&quot;attachment&quot;</span><span class="p">,</span> <span class="n">good</span><span class="p">),</span>
                         <span class="p">(</span><span class="s">&quot;attachment&quot;</span><span class="p">,</span> <span class="n">more</span><span class="p">)]),</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;from&quot;</span><span class="p">:</span> <span class="s">&quot;Excited User &lt;me@samples.mailgun.org&gt;&quot;</span><span class="p">,</span>
              <span class="s">&quot;to&quot;</span><span class="p">:</span> <span class="s">&quot;foo@example.com&quot;</span><span class="p">,</span>
              <span class="s">&quot;cc&quot;</span><span class="p">:</span> <span class="s">&quot;baz@example.com&quot;</span><span class="p">,</span>
              <span class="s">&quot;bcc&quot;</span><span class="p">:</span> <span class="s">&quot;bar@example.com&quot;</span><span class="p">,</span>
              <span class="s">&quot;subject&quot;</span><span class="p">:</span> <span class="s">&quot;Hello&quot;</span><span class="p">,</span>
              <span class="s">&quot;text&quot;</span><span class="p">:</span> <span class="s">&quot;Testing some Mailgun awesomness!&quot;</span><span class="p">,</span>
              <span class="s">&quot;html&quot;</span><span class="p">:</span> <span class="s">&quot;&lt;html&gt;HTML version of the body&lt;/html&gt;&quot;</span><span class="p">})</span>
</pre></div>

    </div>

    

    <div class="entry-tags">
        <span class="label label-default"><a href="/tag/code/">code</a></span>&nbsp;<span class="label label-default"><a href="/tag/python/">python</a></span>&nbsp;
    </div>
</div></div>
        <div class="col-md-3">
          
              <h3 style="margin-top: 0;">Recent Posts</h3>
              
              <div class="entry-item">
                  <time class="updated" datetime="2014-05-20T00:00:00+05:00">May, 20, 2014</time>
                  <a href="/2014/2014-05-20-09-03.html">Simple OS X XKCD client with Automator</a>
              </div>
              
              <div class="entry-item">
                  <time class="updated" datetime="2013-12-19T22:53:00+05:00">Dec, 19, 2013</time>
                  <a href="/2013/2013-12-19-22-48.html">Attaching StringIO Data to a Mailgun Message</a>
              </div>
              
              <div class="entry-item">
                  <time class="updated" datetime="2013-12-05T00:00:00+05:00">Dec, 05, 2013</time>
                  <a href="/2013/2013-12-05-13-01.html">A Picture is worth how many words? Part 1</a>
              </div>
              
              <div class="entry-item">
                  <time class="updated" datetime="2013-12-02T00:00:00+05:00">Dec, 02, 2013</time>
                  <a href="/2013/2013-12-02-12-47.html">Handy Sale Advertisement Guide.</a>
              </div>
              
              <div class="entry-item">
                  <time class="updated" datetime="2013-11-29T00:00:00+05:00">Nov, 29, 2013</time>
                  <a href="/2013/2013-11-29-15-12.html">Black Friday.</a>
              </div>
              
              <div class="entry-item">
                  <time class="updated" datetime="2013-11-18T00:00:00+05:00">Nov, 18, 2013</time>
                  <a href="/2013/2013-11-18-09-34.html">Theme Uploaded</a>
              </div>
              
              <h3>Tags</h3>
              
              <span class="label label-default"><a href="/tag/python/">python</a></span>
              
              <span class="label label-default"><a href="/tag/life/">life</a></span>
              
              <span class="label label-default"><a href="/tag/code/">code</a></span>
              
              <span class="label label-default"><a href="/tag/boring-posts/">boring posts</a></span>
              
              <div class="footer">
                <p class="text-muted"><small>copyright &copy; 2014</small></p>
                <p class="text-muted"><small>Generated by <a href="http://lab.lepture.com/liquidluck/">liquidluck</a></small></p>
              </div>
          
        </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="/static/js/bootstrap.min.js?v=c2e52"></script>
    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46257207-1', 'ikso.us');
    ga('send', 'pageview');

    </script>
    
  </body>
</html>