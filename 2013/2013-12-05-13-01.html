<!DOCTYPE html>
<html>
  <head>
    <title>A Picture is worth how many words? Part 1 - Just a Blahg</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/static/css/bootstrap.min.css?v=072e9" rel="stylesheet">
    <link href="/static/pygments.css?v=f1d2c" rel="stylesheet">
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
    
    <link rel="alternate" type="application/rss+xml" href="/feed.xml" title="Just a Blahg" />
    
<link rel="canonical" href="/2013/2013-12-05-13-01.html" />


  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <nav class="navbar" role="navigation">
            <ul class="nav navbar-nav">
              
              <li><a href="/">Home</a></li>
              <li><a href="/archive.html">Blahg</a></li>
              <li><a href="/machine.html">A Machine</a></li>
            </ul>
            <h1 class="navbar-right">Ikso Blahg</h1>
          </nav>
        </div>
      </div>
      <div class="row">
        <div class="col-md-8 col-md-offset-1"><div class="hentry">
    <h1 class="entry-title">A Picture is worth how many words? Part 1</h1>
    <div class="entry-meta">
        <time class="updated" datetime="2013-12-05T00:00:00+05:00" pubdate>
            <a href="/2013/2013-12-05-13-01.html">2013-12-05</a>
        </time>
        <span class="author vcard">
            by <span class="fn">ikso</span>
        </span>
    </div>
    <div class="entry-content">
        <p>i was playing around with some imaging code, and started wondering what it would look like to create some images out of text. i have worked with stenography in the past, but this time i didn&#39;t want to hide the text, i wanted to pack the image with it.</p>
<p>First things first, i need some text. Time to turn to trusty <a href="http://www.gutenberg.org">Project Gutenberg</a>. i will be using the text of <a href="https://pypi.python.org/pypi/Pillow/2.2.1">Moby Dick</a> for this project.</p>
<div class="highlight"><pre><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;~/Desktop/pg2701.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">fp</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">1257274</span>
</pre></div>
<p>Now i need a couple of functions to help me get started. First, it doesn&#39;t really matter what kind of dimensions my image has, but i would like it to be roughly square.</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">math</span>

<span class="k">def</span> <span class="nf">getDimensions</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Get a rough square based on the amount of data we have &#39;&#39;&#39;</span>
    <span class="n">bits</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">bits</span><span class="p">))</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">bits</span> <span class="o">/</span> <span class="n">w</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
</pre></div>
<p>i am also going to define a generator that will turn my data into a stream of data that will be able to be understood by <a href="http://www.gutenberg.org/ebooks/2701">PIL</a>.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">toPixelStream</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Takes a string and turns it into a sequence of pixel data &#39;&#39;&#39;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">start</span> <span class="o">+</span> <span class="n">size</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">:</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span>
        <span class="k">yield</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">b</span><span class="p">])</span>
        <span class="n">start</span> <span class="o">+=</span> <span class="n">size</span>
</pre></div>
<p>Now i need to decide what image format to use. Here are some of my choices:</p>

<ul>
<li>PNG</li>
<li>JPG</li>
<li>GIF</li>
<li>TIFF</li>
</ul>
<p>JPG is out right away because it is a lossy format. There is no guarantee that any data we put into is going to come back out (i will show you an example in my next post).</p>
<p>GIF isn&#39;t real well suited either because it is an indexed format, and thus limits the number of colors we can use to represent our data. (But&hellip; there is a way&hellip;)</p>
<p>That leaves PNG and TIFF. This time, i will use PNG.</p>
<p>Remember that each pixel in a PNG has four components: Red, Green, Blue, and Alpha. Each of those is one byte, so we will be able to shove four characters into each pixel. Let&#39;s construct some image data!</p>
<div class="highlight"><pre><span class="n">imgdata</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">toPixelStream</span><span class="p">(</span><span class="n">words</span><span class="p">)]</span>
<span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">imgdata</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">314320</span>
<span class="k">print</span> <span class="n">imgdata</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[(</span><span class="mi">239</span><span class="p">,</span> <span class="mi">187</span><span class="p">,</span> <span class="mi">191</span><span class="p">,</span> <span class="mi">84</span><span class="p">),</span> <span class="p">(</span><span class="mi">104</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span> <span class="p">(</span><span class="mi">114</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">101</span><span class="p">),</span> <span class="p">(</span><span class="mi">99</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">71</span><span class="p">)]</span>
</pre></div>
<p>Now we have a list of tuples. Each tuple represents a pixel: (R, G, B, A), and each component of that pixel is the ord of a character in our text. All we have left is to write that out to a file.</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>


<span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s">&#39;RGBA&#39;</span><span class="p">,</span> <span class="n">getDimensions</span><span class="p">(</span><span class="n">words</span><span class="p">)))</span>
<span class="n">img</span><span class="o">.</span><span class="n">putdata</span><span class="p">(</span><span class="n">imgdata</span><span class="p">)</span>

<span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;~/Desktop/pg2701.png&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
<span class="n">img</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
<span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
<p>To the Desktop!</p>
<p><img src="/static/img/pg2701.png" alt="ing"/></p>
<p>And there it is! The entire work of Moby Dick in an image!</p>
<p>But wait, you say. How can we know that our data survived? Ok, let&#39;s try to pull our data back out of the image.</p>
<div class="highlight"><pre><span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;~/Desktop/pg2701.png&#39;</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
<span class="n">newdata</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">getdata</span><span class="p">()</span>
<span class="n">book</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">pixel</span> <span class="ow">in</span> <span class="n">newdata</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">pixel</span><span class="p">:</span>
        <span class="n">book</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">component</span><span class="p">))</span>
<span class="n">book</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">book</span><span class="p">)</span>
<span class="k">print</span> <span class="n">book</span><span class="p">[:</span><span class="mi">181</span><span class="p">]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="s">&quot;&quot;&quot;The Project Gutenberg EBook of Moby Dick; or The Whale, by Herman Melville</span>

<span class="s">This eBook is for the use of anyone anywhere at no cost and with</span>
<span class="s">almost no restrictions whatsoever.&quot;&quot;&quot;</span>
</pre></div>
<p>It worked!</p>

    </div>

    

    <div class="entry-tags">
        <span class="label label-default"><a href="/tag/code/">code</a></span>&nbsp;
    </div>
</div></div>
        <div class="col-md-3">
          
              <h3 style="margin-top: 0;">Recent Posts</h3>
              
              <div class="entry-item">
                  <time class="updated" datetime="2014-05-20T00:00:00+05:00">May, 20, 2014</time>
                  <a href="/2014/2014-05-20-09-03.html">Simple OS X XKCD client with Automator</a>
              </div>
              
              <div class="entry-item">
                  <time class="updated" datetime="2013-12-19T22:53:00+05:00">Dec, 19, 2013</time>
                  <a href="/2013/2013-12-19-22-48.html">Attaching StringIO Data to a Mailgun Message</a>
              </div>
              
              <div class="entry-item">
                  <time class="updated" datetime="2013-12-05T00:00:00+05:00">Dec, 05, 2013</time>
                  <a href="/2013/2013-12-05-13-01.html">A Picture is worth how many words? Part 1</a>
              </div>
              
              <div class="entry-item">
                  <time class="updated" datetime="2013-12-02T00:00:00+05:00">Dec, 02, 2013</time>
                  <a href="/2013/2013-12-02-12-47.html">Handy Sale Advertisement Guide.</a>
              </div>
              
              <div class="entry-item">
                  <time class="updated" datetime="2013-11-29T00:00:00+05:00">Nov, 29, 2013</time>
                  <a href="/2013/2013-11-29-15-12.html">Black Friday.</a>
              </div>
              
              <div class="entry-item">
                  <time class="updated" datetime="2013-11-18T00:00:00+05:00">Nov, 18, 2013</time>
                  <a href="/2013/2013-11-18-09-34.html">Theme Uploaded</a>
              </div>
              
              <h3>Tags</h3>
              
              <span class="label label-default"><a href="/tag/python/">python</a></span>
              
              <span class="label label-default"><a href="/tag/life/">life</a></span>
              
              <span class="label label-default"><a href="/tag/code/">code</a></span>
              
              <span class="label label-default"><a href="/tag/boring-posts/">boring posts</a></span>
              
              <div class="footer">
                <p class="text-muted"><small>copyright &copy; 2014</small></p>
                <p class="text-muted"><small>Generated by <a href="http://lab.lepture.com/liquidluck/">liquidluck</a></small></p>
              </div>
          
        </div>
      </div>
    </div>
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="/static/js/bootstrap.min.js?v=c2e52"></script>
    
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46257207-1', 'ikso.us');
    ga('send', 'pageview');

    </script>
    
  </body>
</html>